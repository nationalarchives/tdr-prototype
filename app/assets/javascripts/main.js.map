{"version":3,"file":"main.js","mappings":"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","sources":["webpack://govuk-prototype-kit/./app/assets/typescript/folder-upload.ts","webpack://govuk-prototype-kit/webpack/bootstrap","webpack://govuk-prototype-kit/webpack/runtime/define property getters","webpack://govuk-prototype-kit/webpack/runtime/hasOwnProperty shorthand","webpack://govuk-prototype-kit/webpack/runtime/make namespace object","webpack://govuk-prototype-kit/./app/assets/typescript/main.ts"],"sourcesContent":["interface IFileWithPath {\n  file: File;\n  path: string;\n}\ninterface FileWithRelativePath extends File {\n  webkitRelativePath: string;\n}\n\ntype IEntryWithPath = IFileWithPath | IDirectoryWithPath;\ntype IDirectoryWithPath = Pick<IFileWithPath, \"path\">;\n\nfunction isFile(entry: IEntryWithPath): entry is IFileWithPath {\n  return (entry as IFileWithPath).file !== undefined;\n}\n\nfunction isDirectory(entry: IEntryWithPath): entry is IFileWithPath {\n  return !isFile(entry);\n}\ninterface IReader {\n  readEntries: (callbackFunction: (entry: IWebkitEntry[]) => void) => void;\n}\n\ninterface IWebkitEntry extends DataTransferItem {\n  createReader: () => IReader;\n  isFile: boolean;\n  isDirectory: boolean;\n  fullPath: string;\n  name?: string;\n  file: (success: (file: File) => void) => void;\n}\n\nexport class FolderUpload {\n  private readonly dropzone: HTMLElement;\n  private readonly itemRetriever: HTMLInputElement;\n  private readonly selected: HTMLElement;\n  private readonly selectedFolderName: HTMLElement;\n  private readonly selectedNumberOfFiles: HTMLElement;\n\n  constructor(root: HTMLElement) {\n    this.itemRetriever = root.querySelector(\".js-drag-and-drop-input\")!;\n    this.dropzone = root.querySelector(\".js-drag-and-drop-zone\")!;\n    this.selected = root.querySelector(\".js-drag-and-drop-selected\")!;\n  }\n\n  initialise: () => void = () => {\n    this.addDropzoneHighlighter();\n    this.addButtonHighlighter();\n    this.addFolderListener();\n  };\n\n  addFolderListener: () => void = () => {\n    this.dropzone.addEventListener(\"drop\", this.handleDroppedItems);\n    this.itemRetriever.addEventListener(\"change\", this.handleSelectedItems);\n  };\n\n  addDropzoneHighlighter: () => void = () => {\n    this.dropzone.addEventListener(\"dragover\", (ev) => {\n      ev.preventDefault();\n      this.dropzone.classList.add(\"drag-and-drop__dropzone--dragover\");\n    });\n\n    this.dropzone.addEventListener(\"dragleave\", () => {\n      this.removeDragover();\n    });\n  };\n\n  addButtonHighlighter: () => void = () => {\n    const itemRetrieverLabel: HTMLLabelElement = this.itemRetriever.labels![0];\n    this.itemRetriever.addEventListener(\"focus\", () => {\n      itemRetrieverLabel.classList.add(\"drag-and-drop__button--highlight\");\n    });\n\n    this.itemRetriever.addEventListener(\"blur\", () => {\n      itemRetrieverLabel.classList.remove(\"drag-and-drop__button--highlight\");\n    });\n  };\n\n  removeDragover: () => void = () => {\n    this.dropzone.classList.remove(\"drag-and-drop__dropzone--dragover\");\n  };\n\n  private getParentFolderName(folder: IEntryWithPath[]) {\n    const firstItem: IEntryWithPath = folder.filter((f) => isFile(f))[0];\n    const relativePath: string = firstItem.path;\n    const splitPath: string[] = relativePath.split(\"/\");\n    return splitPath[0];\n  }\n\n  handleDroppedItems: (ev: DragEvent) => Promise<any> = async (ev) => {\n    ev.preventDefault();\n    const items: DataTransferItemList = ev.dataTransfer?.items!;\n\n    const droppedItem: DataTransferItem | null = items[0];\n    const webkitEntry = droppedItem.webkitGetAsEntry();\n\n    const filesAndFolders: IDirectoryWithPath[] = await this.getAllFiles(\n      webkitEntry as unknown as IWebkitEntry,\n      []\n    );\n\n    this.displaySelectionSuccessMessage(\n      webkitEntry!.name,\n      filesAndFolders.filter((f) => isFile(f)).length\n    );\n  };\n\n  handleSelectedItems: (ev: Event) => any = async (ev) => {\n    ev.preventDefault();\n    const form: HTMLFormElement | null = this.itemRetriever.closest(\"form\");\n\n    console.log(form!.files!.files, this.itemRetriever.files);\n    const selectedFiles = this.convertFilesToIfilesWithPath(form!.files!.files);\n    const parentFolder = this.getParentFolderName(selectedFiles);\n\n    this.displaySelectionSuccessMessage(\n      parentFolder,\n      selectedFiles.filter((f) => isFile(f)).length\n    );\n  };\n\n  getEntryBatch: (reader: IReader) => Promise<IWebkitEntry[]> = (reader) => {\n    return new Promise<IWebkitEntry[]>((resolve) => {\n      reader.readEntries((entries) => resolve(entries));\n    });\n  };\n\n  getFileFromEntry: (entry: IWebkitEntry) => Promise<IFileWithPath> = (\n    entry\n  ) => {\n    return new Promise<IFileWithPath>((resolve) => {\n      entry.file((file) =>\n        resolve({\n          file,\n          path: entry.fullPath,\n        })\n      );\n    });\n  };\n\n  getEntriesFromReader: (reader: IReader) => Promise<IWebkitEntry[]> = async (\n    reader\n  ) => {\n    let allEntries: IWebkitEntry[] = [];\n\n    let nextBatch = await this.getEntryBatch(reader);\n\n    while (nextBatch.length > 0) {\n      allEntries = allEntries.concat(nextBatch);\n      nextBatch = await this.getEntryBatch(reader);\n    }\n\n    return allEntries;\n  };\n\n  getAllFiles: (\n    entry: IWebkitEntry | null,\n    fileInfoInput: IEntryWithPath[]\n  ) => Promise<IEntryWithPath[]> = async (entry, fileInfoInput) => {\n    const reader: IReader = entry!.createReader();\n    const entries: IWebkitEntry[] = await this.getEntriesFromReader(reader);\n    if (entry!.isDirectory && entries.length === 0) {\n      fileInfoInput.push({ path: entry!.fullPath });\n    }\n    for (const entry of entries) {\n      if (entry.isDirectory) {\n        await this.getAllFiles(entry, fileInfoInput);\n      } else {\n        const file: IFileWithPath = await this.getFileFromEntry(entry);\n        fileInfoInput.push(file);\n      }\n    }\n    return fileInfoInput;\n  };\n\n  private convertFilesToIfilesWithPath(files: File[]): IFileWithPath[] {\n    return [...files].map((file) => ({\n      file,\n      path: (file as FileWithRelativePath).webkitRelativePath,\n    }));\n  }\n\n  displaySelectionSuccessMessage: (\n    folderName: string,\n    numberOfFiles: number\n  ) => void = (folderName, numberOfFiles) => {\n    this.removeDragover();\n    this.itemRetriever.blur();\n    this.selected.classList.remove(\"govuk-visually-hidden\");\n\n    let selectedContentFragment = document.createRange()\n      .createContextualFragment(this.selected.firstElementChild.innerHTML);\n\n    selectedContentFragment.querySelector(\n      \".js-drag-and-drop-folder-name\"\n    )!.textContent = folderName;\n    selectedContentFragment.querySelector(\n      \".js-drag-and-drop-no-of-files\"\n    )!.textContent = numberOfFiles.toString();\n\n    this.selected.firstElementChild.innerHTML = \"\";\n    this.selected.firstElementChild.appendChild(selectedContentFragment)\n  };\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { MultiSelectSearch } from \"@nationalarchives/tdr-components\";\nimport { NestedNavigation, InputType } from \"@nationalarchives/tdr-components\";\nimport { FolderUpload } from \"./folder-upload\";\n\nwindow.addEventListener(\"DOMContentLoaded\", (event) => {\n  /**\n   * Multi-select search.\n   */\n  const multiSelects = document.querySelectorAll(\n    \"[data-module=multi-select-search]\"\n  );\n\n  multiSelects.forEach((ms) => {\n    const multiSelectSearch = new MultiSelectSearch(ms as HTMLElement);\n    multiSelectSearch.initialise();\n  });\n\n  /**\n   * Nested Navigation\n   */\n  const tree = document.querySelector(\"[role=tree]\");\n  if (tree != null) {\n    const nestedNavigation = new NestedNavigation(tree as HTMLUListElement);\n    nestedNavigation.initialiseFormListeners(InputType.radios);\n  }\n\n  const folderUpload: HTMLElement = document.querySelector(\n    \"[data-tdr-module=folder-upload]\"\n  );\n  if (folderUpload) {\n    const fu: FolderUpload = new FolderUpload(folderUpload);\n    fu.initialise();\n  }\n});\n"],"names":[],"sourceRoot":""}