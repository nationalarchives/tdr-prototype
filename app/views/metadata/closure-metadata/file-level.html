{% extends "layout.html" %}
{% include "../dummyfiles.html" %}

{% block pageTitle %}
File level closure metadata
{% endblock %}

{% block beforeContent %}
  <a href="../additional-metadata.html" class="govuk-back-link">Back</a>
{% endblock %}

{% block content %}
  <form action="/metadata/closure-metadata/confirm-file-level">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-l">Add or edit closure metadata on file basis</h1>
        {{releaseVersion | log }}
        <p class="govuk-body">
        You can now add or edit closure metadata to individual files or folders.
      </p>
        <p class="govuk-body">
        Select the relevant record(s) from the table below and proceed by clicking
        "Add or Edit metadata".
      </p>

        <div class="govuk-tdr-file-selection-panel">
          <div class="govuk-tdr-file-selection-panel__search">
            <input
            class="govuk-input"
            id="event-name"
            name="event-name"
            type="search"
            placeholder="Enter a file or folder name"/>
            <a
              href="file-level"
              role="button"
              draggable="false"
              class="govuk-button"
              data-module="govuk-button"
            >
              Search
          </a>
          </div>
          <div class="govuk-button-group">
            <button
              draggable="false"
              class="govuk-button"
              data-module="govuk-button"
            >
              Add or Edit metadata
            </button>
            <button
            class="govuk-button govuk-button--secondary"
            data-module="govuk-button"
            type="button"
            name="select-all"
            value="true"
            >
            Select all
          </button>

            <button
            class="govuk-button govuk-button--secondary"
            data-module="govuk-button"
            type="button"
            name="deselect-all"
            value="true"
          >
            Clear selection
          </button>
          </div>
        </div>

        {% macro fileItem(item, level, size, pos) %}
          {% set itemName = level +"-"+ pos+"-"+(item.name|urlencode) %}
          {% if item.type == 'file' or item.children.length == 0 %}
            <li
              class="govuk-tna-tree__file-item"
              role="treeitem"
              id="{{level}}-{{pos}}"
              aria-selected="false"
              aria-level="{{level}}"
              aria-setsize="{{size}}"
              aria-posinset="{{pos}}"
            >
              <div class="govuk-checkboxes__item">
                <input name="file-selection" class="govuk-checkboxes__input" id="checkbox-{{level}}-{{pos}}" value="{{itemName}}" tabindex="-1" type="checkbox"/>
                <label class="govuk-label govuk-checkboxes__label" for="checkbox-{{level}}-{{pos}}">
                  {{item.name}}
                  {% if data['closedFiles'][itemName] !== undefined %}
                    <span class="icon" aria-label="Has existing metadata">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"/></svg>
                    </span>
                  {% endif %}
                </label>
              </div>
            </li>

          {% elif item.type == 'directory' %}
            <li
              class="govuk-tna-tree__folder-item"
              role="treeitem"
              id="{{level}}-{{pos}}"
              aria-expanded="true"
              aria-selected="false"
              aria-level="{{level}}"
              aria-setsize="{{size}}"
              aria-posinset="{{pos}}"
            >
              <div class="govuk-tna-tree__folder-item__container">
                <button
                class="govuk-tna-tree__file-expander"
                tabindex="-1"
                id="expander-{{level}}-{{pos}}"
              >
                  <span class="govuk-visually-hidden">Expand</span>
                </button>
                <div class="govuk-checkboxes__item">
                  <input name="file-selection-directory" class="govuk-checkboxes__input" id="checkbox-{{level}}-{{pos}}" value="itemName" tabindex="-1" type="checkbox"/>

                  <label class="govuk-label govuk-checkboxes__label" for="checkbox-{{level}}-{{pos}}">
                    <img class="govuk-tna-tree__svg-directory" role="img" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyMiI+PHBhdGggZmlsbD0iIzAwMCIgZD0iTTIyIDMuNUgxMC42ODNMOC43NTguODVhMS42NjcgMS42NjcgMCAwIDAtMS4zNS0uNjgzSDJBMS42NjcgMS42NjcgMCAwIDAgLjMzMyAxLjgzM3YxOC4zMzRBMS42NjcgMS42NjcgMCAwIDAgMiAyMS44MzNoMjBhMS42NjcgMS42NjcgMCAwIDAgMS42NjctMS42NjZ2LTE1QTEuNjY2IDEuNjY2IDAgMCAwIDIyIDMuNVptMCAxNi42NjdIMlY2LjgzM2g2LjA5MmExLjY2NyAxLjY2NyAwIDAgMCAxLjY2Ni0xLjY2NkgyVjEuODMzaDUuNDA4bDIuMTc1IDIuOTkyYS44MzMuODMzIDAgMCAwIC42NzUuMzQySDIydjE1WiIvPjwvc3ZnPg==" alt="Directory"/>
                    {{item.name}}
                  </label>
                </div>
              </div>
              <ul class="govuk-tna-tree__nested-file-list" role="group" id="folder-group-{{level}}-{{pos}}">
                {% set nextLevel = level + 1 %}
                {% for child in item.children %}
                  {{ fileItem(child, nextLevel, loop.length, loop.index) }}
                {% endfor %}
              </ul>
            </li>
          {% endif %}
        {% endmacro %}
      </div>
      <div class="govuk-grid-column-full">
        <div class="govuk-tna-tree">
          <ul tabindex="0"class="govuk-tna-tree__nested-file-list" role="tree" aria-multiselectable="true">
            {% for node in data.files %}
              {{ fileItem(node, 1, loop.length, loop.index) }}
            {% endfor %}
          </ul>
        </div>

        <div class="govuk-button-group">
          <button
        draggable="false"
        class="govuk-button"
        data-module="govuk-button"
      >
        Add or Edit metadata
      </button>

          {# <a
          href="./baking-powder/abandon-changes-warning.html"
          role="button"
          draggable="false"
          class="govuk-button govuk-button--warning"
        >
          Delete metadata
        </a> #}
        </div>

        <br/>
      </div>
    </div>
  </form>
  <script type="text/javascript">
    function check_all() {
      var checkboxes = document.getElementsByName('organisation');
      checkboxes = [...checkboxes];
      for (var i = 0; i < checkboxes.length; i++) {
        checkboxes[i].checked = true
      }
    }

    function deselect_all() {
      var checkboxes = document.getElementsByName('organisation');
      checkboxes = [...checkboxes];
      for (var i = 0; i < checkboxes.length; i++) {
        checkboxes[i].checked = false
      }
    }
  </script>
{% endblock %}

{% block pageScripts %}
  <script src="/public/javascripts/tree-view.js"></script>
{% endblock %}