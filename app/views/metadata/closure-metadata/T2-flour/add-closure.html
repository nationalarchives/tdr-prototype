{% extends "layout.html" %}

{% block pageTitle %}
Add closure fields to 'Cocoa.docx'
{% endblock %}

{% block content %}

  <form action="./add-closure-confirm" >
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-l">
            Add closure metadata to 'Cocoa.docx'
        </h1>{{releaseVersion | log }}
        <p class="govuk-body">Enter closure metadata for your file(s).</p>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <div class="govuk-form-group">
          <fieldset class="govuk-fieldset" role="group" aria-describedby="foi-decision-hint">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
              <h2 class="govuk-fieldset__heading">
                        FOI decision asserted
                    </h2>
            </legend>
            <div id="foi-decision-hint" class="govuk-hint">
                    Date of the Advisory Council approval
                  </div>
            <div class="govuk-date-input" id="passport-issued">
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="foi-asserted-day" >
                                Day
                            </label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="foi-asserted-day"
                                name="foi-asserted-day" type="text" pattern="[0-9]*" inputmode="numeric" placeholder="dd" value="{% if data['foi-asserted-day'] %}{{data['foi-asserted-day']}}{%endif%}">
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="foi-asserted-month">
                                Month
                            </label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2"
                                id="foi-asserted-month" name="foi-asserted-month" type="text" pattern="[0-9]*"
                                inputmode="numeric" placeholder="mm" value="{% if data['foi-asserted-month'] %}{{data['foi-asserted-month']}}{%endif%}">
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="foi-asserted-year">
                                Year
                            </label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-4"
                                id="foi-asserted-year" name="foi-asserted-year" type="text" pattern="[0-9]*"
                                inputmode="numeric" placeholder="yyyy" value="{% if data['foi-asserted-year'] %}{{data['foi-asserted-year']}}{%endif%}">
                </div>
              </div>
            </div>
          </fieldset>
        </div>

        <div class="govuk-form-group">
          <fieldset class="govuk-fieldset" role="group" aria-describedby="closure-start-hint">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
              <h2 class="govuk-fieldset__heading">
                        Closure start date
                    </h2>
            </legend>
            <div id="closure-start-hint" class="govuk-hint">
                    This has been defaulted to the last date modified, if this is not correct, amend the field below.
                </div>
            <div class="govuk-date-input" id="passport-issued">
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="closure-start-day">
                                Day
                            </label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2"
                                id="closure-start-day" name="closure-start-day" type="text" pattern="[0-9]*"
                                inputmode="numeric" placeholder="dd"  value="{% if data['closure-start-day'] %}{{data['closure-start-day']}}{% else %}12{%endif%}">
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="closure-start-month">
                                Month
                            </label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2"
                                id="closure-start-month" name="closure-start-month" type="text" pattern="[0-9]*"
                                inputmode="numeric" placeholder="mm"  value="{% if data['closure-start-month'] %}{{data['closure-start-month']}}{% else %}07{%endif%}">
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="closure-start-year">
                                Year
                            </label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-4"
                                id="closure-start-year" name="closure-start-year" type="text" pattern="[0-9]*"
                                inputmode="numeric" placeholder="yyyy" value="{% if data['closure-start-year'] %}{{data['closure-start-year']}}{% else %}2010{%endif%}">
                </div>
              </div>
            </div>
          </fieldset>
        </div>

        <div class="govuk-form-group">
          <h2 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="closure-period">
                Closure period
            </label>
          </h2>
          <div id="closure-period-hint" class="govuk-hint">
                Number of years the record is closed from the closure start date
            </div>
          <div class="govuk-input__wrapper"><input class="govuk-input govuk-input--width-5" id="closure-period" name="closure-period" type="text" spellcheck="false" value="{% if data['closure-period'] %}{{data['closure-period']}}{%endif%}">
            <div class="govuk-input__suffix" aria-hidden="true">years</div>
          </div>
        </div>

        <div class="govuk-form-group">
          <h2 class="govuk-heading-m">FOI exemption code(s)</h2>

          <div class="govuk-hint">
              Add one or more exemption code to this closure.
          </div>

          {% if data.foi_id_selection == undefined %}
            <p>
              <a class="govuk-link" id="foi-exemption-link" href="./add-multiple-FOI.html">Add exemption code(s)</a>
            </p>
          {% else %}
            <ul class="govuk-list govuk-list--bullet">
              {% for id in data.foi_id_selection %}
                <li>{{id}}</li>
              {% endfor %}
            </ul>
            <p>
              <a class="govuk-link" href="./add-multiple-FOI.html">Edit or remove exemption code(s)</a>
            </p>
          {% endif %}
          <input id="exemption-code-redir" type="hidden" name="exemption-code-redir" value="false"/>
        </div>

        <div class="govuk-form-group{% if data['error'] %} govuk-form-group--error{% endif %}">
          <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
                    Are the title and/or description closed?
                </legend>
            {% if data['error'] == 'no-alternative-choice' %}
              <p id="no-alternative-choice" class="govuk-error-message">
                <span class="govuk-visually-hidden">Error:</span> Please choose if there is an alternative title and/or description for this record
            </p>
            {% endif %}
            <div class="govuk-radios">
              <div class="govuk-radios__item">
                <input {% if data["is-the-title-sensitive"] == "yes" %}checked{%endif%} class="govuk-radios__input" id="yes" name="is-the-title-sensitive" type="radio" value="yes">
                <label class="govuk-label govuk-radios__label" for="yes">
                            Yes
                        </label>
              </div>
              <div class="govuk-radios__item">
                <input {% if data["is-the-title-sensitive"] == "no" %}checked{%endif%} class="govuk-radios__input" id="no" name="is-the-title-sensitive" type="radio" value="no">
                <label class="govuk-label govuk-radios__label" for="no">
                            No
                        </label>
              </div>
            </div>
          </fieldset>
        </div>

        <div class="govuk-button-group">
          <button role="button" draggable="false" class="govuk-button" data-module="govuk-button">
                Continue
            </button>
          <a class="govuk-link govuk-link--no-visited-state" href="../file-level.html">Cancel</a>
        </div>

      </div>
    </div>
  </form>

  <script type="text/javascript">

    document.addEventListener('DOMContentLoaded', function () {
      const foiLink = document.querySelector("#foi-exemption-link");
      foiLink.addEventListener("click", (e) => {
        e.preventDefault();
        document
          .querySelector("#exemption-code-redir")
          .value = "true";
        document
          .querySelector("form")
          .submit()
      })

      /*
      const getAllFOIids = (selects) => {
        const ids = []
        selects.forEach((s) => {
          ids.push(s.options[s.selectedIndex].text)
        })
        return ids;
      }

      const postAllIds = (ids) => {
        let xhr = new XMLHttpRequest();
        xhr.open("GET", `add-multiple-FOI/update/${JSON.stringify(ids)}`);
        xhr.send();
        xhr.onload = () => console.log("updated");
      }

      const foiSelects = document.querySelectorAll(".foi-selects");

      foiSelects.forEach((el) => {
        el.addEventListener("change", () => {
          const ids = getAllFOIids(foiSelects);
          postAllIds(ids);
        })
      })
  */
    }, false);
  </script>

{% endblock %}