<div class="tdr-scroll-container tdr-scroll-container__horizontal">
<table data-module="table-row-menu-hide-show" class="govuk-table tdr-summary-table tdr-summary-table--sort-by-dir">
  <colgroup>
    <col style="min-width: 200px;"/>
    <col  />
    <col  />
    <col />
  </colgroup>
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header">Record name</th>
      <th scope="col" class="govuk-table__header">Extracted date</th>
      <th scope="col" class="govuk-table__header">Corrected date</th>
      <th scope="col" class="govuk-table__header"><span class="govuk-visually-hidden">Actions</span></th>
      <th id="header-dir" scope="col" class="govuk-visually-hidden">Directory</th>
    </tr>
  </thead>

{% if data['recordsMetadata']|length == 0 %}
  <tr>
    <td colspan="6" class="govuk-table__cell govuk-table__cell--no-results">
      There are no records to show.
      <a href="./ut-3?sort=directory">Clear current filters</a>
    </td>
  </tr>
{% else %}
  {% for item in data['recordsMetadata'] %}
    {% if currentDirectory != item.path %}
      {% set currentDirectory = item.path %}
      <tr>
        <td colspan="6" headers="header-dir" id="{{currentDirectory|urlencode}}" class="tdr-summary-table__dir-cell govuk-body govuk-!-font-size-14" >
          <ol class="tdr-file-breadcrumbs">
          {% set currStrIndex = 0 %}
          {% for dir in currentDirectory|split("/") %}
            <li class="tdr-file-breadcrumbs__list-item">{{dir|highlightMatches(item.matches, "path", currStrIndex, currentDirectory)|safe}}</li>
            {% set currStrIndex = 1+currStrIndex+dir|length %}
          {% else %}
            <li class="tdr-file-breadcrumbs__list-item">/</li>
          {% endfor %}
          </ol>
          {% set filesInDir = currentDirectory|countInDir(data['recordsMetadata'], true) %}
          <span class="tdr-summary-table__file-count">{{filesInDir}} file{% if filesInDir != 1 %}s{%  endif %}</span>
        </td>
      </tr>
    {% endif %}
      <tr class="govuk-table__row">
        <td headers="{{currentDirectory|urlencode}}" id="{{currentDirectory|urlencode}}{{item.id|urlencode}}" class="govuk-table__header govuk-table__header--spacious">
          {{item.name|highlightMatches(item.matches, "name")|safe}}
        </td>
        <td headers="{{currentDirectory|urlencode}}{{item.id|urlencode}}" class="govuk-table__cell govuk-table__cell--nowrap">
          {{item['ldm-extracted-day']}} {{item['ldm-extracted-month']|getMonthName("short")}} {{item['ldm-extracted-year']}}
        </td>
        <td headers="{{currentDirectory|urlencode}}{{item.name|urlencode}}" class="govuk-table__cell govuk-table__cell--nowrap">
          {% if item['ldm-corrected-day'] and item['ldm-corrected-month'] and item['ldm-corrected-year']%}
          {{item['ldm-corrected-day']}} {{item['ldm-corrected-month']|getMonthName("short")}} {{item['ldm-corrected-year']}}
          {% endif %}
        </td>
        <td headers="{{currentDirectory|urlencode}}{{item.id|urlencode}}" class="govuk-table__cell govuk-table__cell--with-hidden-menu">
          <a class="govuk-link govuk-link--no-visited-state" href="./edit/{{currentDirectory|urlencode}}{{item.name|urlencode}}?{{data.queryParamsString}}">Edit<span class="govuk-visually-hidden">&nbsp;metadata for {{item.name}}</span></a>
        </td>
      </tr>
  {% endfor %}
{% endif %}
  </tbody>
</table>
</div>
